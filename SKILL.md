---
name: skill-router
description: AI Agent 技能路由器。在执行任何创作、处理、发布类任务前，必须先通过此技能查询可用技能并制定执行计划。
version: 1.1.0
author: Gravity
triggers:
  - 写公众号
  - 写文章
  - 生成图片
  - 发布
  - 使用技能
  - 扫描skills
---

# Skill Router - 技能路由器

## ⚠️ 核心原则

**绝不跳过任何步骤。绝不自作主张。每一步都需要用户确认。**

---

## 执行流程（严格按顺序）

### 第一步：扫描可用技能

**触发条件**：收到任何创作、处理、发布类任务时

**执行命令**：
```bash
skill-router list
```

**必须展示给用户**：完整的技能列表

---

### 第二步：分析需求并制定计划

**不要开始执行！** 先分析用户需求，制定执行计划。

**必须输出以下格式**：

```
## 📋 执行计划

### 任务分析
- 用户需求：[一句话总结]
- 任务类型：[写作/图片生成/发布/其他]

### 推荐技能
| 序号 | 技能 ID | 用途 | 是否必须 |
|------|---------|------|----------|
| 1 | xxx | xxx | 是/否 |
| 2 | xxx | xxx | 是/否 |

### 执行顺序
1. 第一步：[技能名] - [做什么]
2. 第二步：[技能名] - [做什么]
...

### 预计产出
- [产出物 1]
- [产出物 2]

---
⚠️ 请确认以上计划，回复「确认」开始执行，或告诉我需要调整的地方。
```

**等待用户确认后才能继续！**

---

### 第三步：逐个执行技能（必须）

用户确认后，**按顺序逐个执行**：

1. 告知用户："现在开始执行第 X 步：[技能名]"
2. 执行 `skill-router show <skill-id>` 获取 SKILL.md 路径
3. 读取该技能的完整 SKILL.md
4. 按照 SKILL.md 执行
5. 展示产出，询问："第 X 步完成，是否继续？"
6. 等待确认后继续下一步

---

### 第四步：执行总结与核查

**所有技能执行完毕后，必须输出以下格式**：

```
## ✅ 执行总结

### 完成情况
| 序号 | 技能 | 状态 | 产出 |
|------|------|------|------|
| 1 | xxx | ✅ 已完成 | [产出描述] |
| 2 | xxx | ✅ 已完成 | [产出描述] |
| 3 | xxx | ⏭️ 已跳过 | 用户要求跳过 |

### 产出物清单
- [x] 产出物 1：[路径或描述]
- [x] 产出物 2：[路径或描述]

### 未完成项（如有）
- [ ] xxx：[原因]

---
任务完成！如需调整或补充，请告诉我。
```

---

### 第五步：工作流保存（可选）

如果本次任务使用了 **2 个或以上技能**，询问用户：

```
本次任务使用了以下技能组合：
[技能1] → [技能2] → [技能3]

是否保存为工作流？下次可以快速执行。
- 回复「保存」+ 工作流名称（如：保存 公众号写作流程）
- 回复「不保存」跳过
```

---

## 命令速查

```bash
# 列出所有技能
skill-router list

# 查看技能详情（获取 SKILL.md 路径）
skill-router show <skill-id>

# 精简列表
skill-router export --brief

# 工作流相关
skill-router workflow list              # 查看已保存的工作流
skill-router workflow match "用户请求"  # 匹配工作流
skill-router workflow save "名称" --triggers "触发词" --steps "skill1,skill2"
```

---

## 示例：完整执行流程

```
用户：帮我写一篇关于 AI Agent 的公众号文章

Agent：让我先扫描可用技能...

[执行 skill-router list]

## 📋 执行计划

### 任务分析
- 用户需求：撰写一篇关于 AI Agent 的公众号文章
- 任务类型：写作

### 推荐技能
| 序号 | 技能 ID | 用途 | 是否必须 |
|------|---------|------|----------|
| 1 | dankoe-writer | 生成初稿 | 是 |
| 2 | three-writers-council | 三人会议打磨 | 推荐 |
| 3 | baoyu-cover-image | 生成封面图 | 推荐 |
| 4 | humanizer-zh | 去除 AI 痕迹 | 可选 |

### 执行顺序
1. 第一步：dankoe-writer - 生成 Dan Koe 风格初稿
2. 第二步：three-writers-council - 三人会议打磨文章
3. 第三步：baoyu-cover-image - 生成封面图

### 预计产出
- 一篇打磨后的公众号长文
- 一张封面图

---
⚠️ 请确认以上计划，回复「确认」开始执行，或告诉我需要调整的地方。

用户：确认，但跳过封面图

Agent：好的，调整计划：跳过第三步（封面图）。

现在开始执行第一步：dankoe-writer
[读取 dankoe-writer 的 SKILL.md]
[按照 SKILL.md 执行]

---
第一步完成，产出：[初稿内容]
是否继续第二步（three-writers-council）？

用户：继续

Agent：现在开始执行第二步：three-writers-council
[读取 three-writers-council 的 SKILL.md]
[按照 SKILL.md 执行]

---
第二步完成，产出：[打磨后的文章]

## ✅ 执行总结

### 完成情况
| 序号 | 技能 | 状态 | 产出 |
|------|------|------|------|
| 1 | dankoe-writer | ✅ 已完成 | 初稿 3000 字 |
| 2 | three-writers-council | ✅ 已完成 | 打磨后文章 2800 字 |
| 3 | baoyu-cover-image | ⏭️ 已跳过 | 用户要求跳过 |

### 产出物清单
- [x] 公众号文章：已生成

---
任务完成！

本次任务使用了以下技能组合：
dankoe-writer → three-writers-council

是否保存为工作流？
```

---

## 错误处理

### 如果某个技能执行失败

```
⚠️ 第 X 步执行失败

技能：[技能名]
错误：[错误信息]

选项：
1. 重试此步骤
2. 跳过此步骤，继续下一步
3. 终止任务

请选择（1/2/3）：
```

### 如果用户中途要求停止

```
⏸️ 任务已暂停

已完成：
- [x] 第一步：xxx
- [x] 第二步：xxx

未完成：
- [ ] 第三步：xxx

如需继续，请说「继续」。
```

---

## 注意事项

1. **永远不要跳过第二步（计划确认）**
2. **每个技能执行前都要读取其 SKILL.md**
3. **每个技能执行后都要等用户确认**
4. **最后必须输出执行总结**
5. **2+ 技能时询问是否保存工作流**

---

## 禁止行为

❌ 收到任务后直接开始工作（没有先扫描技能）
❌ 扫描后直接执行（没有制定计划让用户确认）
❌ 执行完一个技能后直接执行下一个（没有等用户确认）
❌ 任务完成后不输出执行总结
❌ 使用多个技能后不询问是否保存工作流

---

## 正确行为

✅ 收到任务 → 先 `skill-router list`
✅ 扫描后 → 输出执行计划 → 等用户确认
✅ 执行每步前 → 读取 SKILL.md → 告知用户
✅ 执行每步后 → 展示产出 → 等用户确认继续
✅ 全部完成后 → 输出执行总结表格
✅ 多技能任务后 → 询问保存工作流
